<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Sites to scan</title>
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <style>
        body {
            font-family: "Segoe UI";
        }

        #content {
            margin-left: 15px;
        }

        #sitestable, tr{
            border: 1px solid black;
        }

        th {
            text-align: left;
        }

        header {
            font-size: 29px;
            margin: 15px;
        }

        form {
            float: left;
            font-size: 15px;
            margin-right: 20px;
            margin-left: 15px;
        }
    </style>
    <script>
        "use strict";

        $(function () {
            $(document).ready(function () {
                $.ajax({
                    type: "GET",
                    url: "/static/websites.csv",
                    dataType: "text",
                    success: function (data) {
                        processCsv(data);
                        $("#displaytext").html("Current list:");
                        $("#sitestable").show();

                    },
                    error: function () {
                        $("#sitestable").hide();
                        $("#displaytext").html("No file 'websites.csv' has been found. Please upload one.");
                    }
                });
            });
        });

        function processCsv(data) {
            var allTextLines = data.split(/\r\n|\n/);
            for (var i = 1; i < allTextLines.length; i++) {
                var site = allTextLines[i].split(',');
                if (site[0] !== '') {
                    $("#sitestable").append('<tr>' +
                     '<td>' + site[0] + '</td>' +
                     '<td>' + site[1] + '</td>' +
                     '<td>' + site[2] + '</td> +' +
                     '</tr>');
                }
            }
        }
    </script>
</head>
<body>
    <header>Site List</header>
    <form enctype="multipart/form-data" action="/sites" method="post" onsubmit="return submitForm();">
        <label style="display: block">Upload CSV:</label>
        <input type="file" value="Upload new CSV" accept=".csv" />
    </form>
    <div id="content">
        <div id="displaytext">Loading site list...</div>
        <table id="sitestable" style="display: none">
            <tr>
                <th>Site URL</th>
                <th>Region</th>
                <th>Rank</th>
            </tr>
        </table>
    </div>
</body>
</html>